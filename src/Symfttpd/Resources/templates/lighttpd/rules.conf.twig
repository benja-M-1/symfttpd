{% block rules %}
url.rewrite-once = (
{% for dir in server.allowedDirs %}
  "^/{{ dir|preg_quote }}/.+" => "$0",
{% endfor %}

{% for file in server.allowedFiles %}
  "^/{{ file|preg_quote }}$" => "$0",
{% endfor %}

{% for php in server.executableFiles %}
  "^/{{ php|preg_quote }}(/[^\?]*)?(\?.*)?" => "/{{ php }}$1$2",
{% endfor %}

  "^(/[^\?]*)(\?.*)?" => "/{{ server.indexFile }}$1$2"
)

{% for file in server.unexecutableDirs %}
{% if dirs[file] is defined %}
$HTTP["url"] =~ "^/{{ file }}/" {
  url.access-deny = (".php")
}
{% endif %}
{% endfor %}
{% endblock rules %}
